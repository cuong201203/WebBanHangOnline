@model WebBanHangOnline.Models.EF.Product
@{
    ViewBag.Title = "Detail";
}

<link rel="stylesheet" type="text/css" href="~/Content/assets/styles/product_detail_styles.css">
<link rel="stylesheet" type="text/css" href="~/Content/assets/styles/product_detail_responsive.css">

<style>
    .product_detail_container p {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif !important;
        font-size: 14px !important;
        line-height: 1.7 !important;
        font-weight: 500 !important;
        color: #51545f !important;
        -webkit-font-smoothing: antialiased !important;
        -webkit-text-shadow: rgba(0,0,0,.01) 0 0 1px !important;
        text-shadow: rgba(0,0,0,.01) 0 0 1px !important;
    }

    .product_detail_container .product_details {
        width: 100% !important;
    }

    .product_detail_container .product_details_title {
        font-weight: 500 !important;
        line-height: 30px !important;
    }

        .product_detail_container .product_details_title p {
            margin-top: 12px !important;
        }

    .product_detail_container .original_price {
        font-weight: 500 !important;
        color: #b9b4c7 !important;
        text-decoration: line-through !important;
        line-height: 30px !important;
        margin-top: 21px !important;
    }

    .product_detail_container .product_price {
        display: inline-block !important;
        font-size: 24px !important;
        color: #fe4c50 !important;
        font-weight: 500 !important;
        line-height: 30px !important;
        margin-top: 2px !important;
    }

    .product_detail_container .star_rating {
        display: inline-block !important;
        margin-left: 33px !important;
    }

        .product_detail_container .star_rating li {
            display: inline-block !important;
            margin-right: -2px !important;
            cursor: pointer !important;
        }

            .product_detail_container .star_rating li i {
                color: #fac451 !important;
            }

    .product_detail_container .product_color {
        margin-top: 27px !important;
    }

        .product_detail_container .product_color ul {
            display: inline-block !important;
            margin-left: 26px !important;
        }

            .product_detail_container .product_color ul li {
                display: inline-block !important;
                width: 12px !important;
                height: 12px !important;
                border-radius: 50% !important;
                margin-right: 29px !important;
                cursor: pointer !important;
            }

    .product_detail_container .quantity {
        width: 100% !important;
        height: 40px !important;
        margin-top: 23px !important;
    }

    .product_detail_container .quantity_selector {
        display: -webkit-box !important;
        display: -moz-box !important;
        display: -ms-flexbox !important;
        display: -webkit-flex !important;
        display: flex !important;
        flex-direction: row !important;
        justify-content: space-between !important;
        align-items: center !important;
        width: 132px !important;
        height: 100% !important;
        border: solid 1px #e5e5e5 !important;
        margin-left: 29px !important;
    }

        .product_detail_container .quantity_selector span {
            font-weight: 500 !important;
            color: #232530 !important;
        }

    .product_detail_container .plus,
    .product_detail_container .minus {
        padding-left: 14px !important;
        padding-right: 14px !important;
        cursor: pointer !important;
    }

        .product_detail_container .plus:hover,
        .product_detail_container .minus:hover {
            color: #b5aec4 !important;
        }

    .product_detail_container .add_to_cart_button {
        width: 160px !important;
        margin-left: 19px !important;
        font-size: 12px !important;
        visibility: visible !important;
        opacity: 1 !important;
    }

    .product_detail_container .star_rating,
    .product_detail_container .star_rating li,
    #load_review .star_rating,
    #load_review .star_rating li {
        cursor: default !important;
    }

    .review_submit_btn {
        width: 170px !important;
        border: none !important;
        color: #FFFFFF !important;
        text-transform: uppercase !important;
        font-size: 14px !important;
        font-weight: 500 !important;
        cursor: pointer !important;
    }
</style>

@if (Model != null)
{
    <div class="container single_product_container product_detail_container">
        <div class="row">
            <div class="col">

                <!-- Breadcrumbs -->

                <div class="breadcrumbs d-flex flex-row align-items-center">
                    <ul>
                        <li><a href="/">Trang chủ</a></li>
                        <li><a href="/danh-muc-san-pham/@Model.ProductCategory.Alias-@Model.ProductCategory.Id"><i class="fa fa-angle-right" aria-hidden="true"></i>@Model.ProductCategory.Title</a></li>
                        <li class="active"><a href="#"><i class="fa fa-angle-right" aria-hidden="true"></i>@Model.Title</a></li>
                    </ul>
                </div>

            </div>
        </div>

        <div class="row">
            <div class="col-lg-7">
                @if (Model.ProductImage != null && Model.ProductImage.Any())
                {
                    <div class="single_product_pics">
                        <div class="row">
                            <div class="col-lg-3 thumbnails_col order-lg-1 order-2">
                                <div class="single_product_thumbnails">
                                    <ul>
                                        @foreach (var item in Model.ProductImage)
                                        {
                                            if (item.IsDefault)
                                            {
                                                <li class="active"><img src="@item.Image" alt="" data-image="@item.Image"></li>
                                            }
                                            else
                                            {
                                                <li><img src="@item.Image" alt="" data-image="@item.Image"></li>
                                            }
                                        }
                                    </ul>
                                </div>
                            </div>
                            <div class="col-lg-9 image_col order-lg-2 order-1">
                                <div class="single_product_image">
                                    <div class="single_product_image_background" style="background-image:url(@Model.ProductImage.FirstOrDefault(x => x.IsDefault).Image"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                }
            </div>
            <div class="col-lg-5">
                <div class="product_details">
                    <div class="product_details_title">
                        <h2>@Model.Title</h2>
                        <p>@Model.Description</p>
                    </div>
                    @if (Model.PriceSale > 0)
                    {
                        <div class="original_price">@string.Format("{0:N0}", Model.Price)<u>đ</u></div>
                        <div class="product_price">@string.Format("{0:N0}", Model.PriceSale)<u>đ</u></div>
                    }
                    else
                    {
                        <div class="product_price">@string.Format("{0:N0}", Model.Price)<u>đ</u></div>
                    }
                    <ul class="star_rating">
                        @if (ViewBag.CountReview > 0)
                        {
                            var fullStars = Math.Floor(ViewBag.AverageRating);
                            var halfStar = ViewBag.AverageRating % 1 >= 0.5;

                            for (int i = 0; i < fullStars; i++)
                            {
                                <li><i class="fa fa-star" aria-hidden="true"></i></li>
                            }

                            if (halfStar)
                            {
                                <li><i class="fa fa-star-half-o" aria-hidden="true"></i></li>
                            }

                            for (int i = 0; i < (5 - fullStars - (halfStar ? 1 : 0)); i++)
                            {
                                <li><i class="fa fa-star-o" aria-hidden="true"></i></li>
                            }
                        }

                        else
                        {
                            for (int i = 0; i < 5; i++)
                            {
                                <li><i class="fa fa-star-o" aria-hidden="true"></i></li>
                            }
                        }
                    </ul>

                    <div class="quantity d-flex flex-column flex-sm-row align-items-sm-center">
                        <span>Số lượng:</span>
                        <div class="quantity_selector" @(Model.Quantity == 0 ? "style='pointer-events:none; opacity:0.5;'" : "")>
                            <span class="minus"><i class="fa fa-minus" aria-hidden="true"></i></span>
                            @if (Model.Quantity == 0)
                            {
                            <span class="fa">Hết hàng</span>
                            }
                            else
                            {
                            <span id="quantity_value">1</span>
                            }
                            <span class="plus"><i class="fa fa-plus" aria-hidden="true"></i></span>
                        </div>
                        <div class="red_button add_to_cart_button"><a href="#" class="btnAddToCart" data-id="@Model.Id">thêm vào giỏ</a></div>
                        @*<div class="product_favorite d-flex flex-column align-items-center justify-content-center"></div>*@
                    </div>
                </div>
            </div>
        </div>

    </div>

    <div class="tabs_section_container">
        <div class="container">
            <div class="row">
                <div class="col">
                    <div class="tabs_container">
                        <ul class="tabs d-flex flex-sm-row flex-column align-items-left align-items-md-center justify-content-center">
                            <li class="tab active" data-active-tab="tab_1"><span>Chi tiết sản phẩm</span></li>
                            @*<li class="tab" data-active-tab="tab_2"><span>Additional Information</span></li>*@
                            <li class="tab" data-active-tab="tab_3"><span>Đánh giá (@ViewBag.CountReview)</span></li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col">

                    <!-- Tab Description -->
                    <div id="tab_1" class="tab_container active">
                        <div class="row">
                            @Html.Raw(Model.Detail)
                        </div>
                    </div>

                    <!-- Tab Reviews -->
                    <div id="tab_3" class="tab_container">
                        <div class="row">
                            <!-- User Reviews -->
                            <div class="col-lg-6 reviews_col" id="load_review">
                                @Html.Action("_LoadReview", "ReviewProduct", new { productId = Model.Id })

                            </div>

                            <!-- Add Review -->
                            <div class="col-lg-6 add_review_col">
                                @Html.Action("_Review", "ReviewProduct", new { productId = Model.Id })
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>

    @Html.Action("Partial_ProductRelated", "Product", new { categoryId = Model.ProductCategoryId, productId = Model.Id })
}
@section scripts{
    <script src="~/Content/assets/js/product_detail_custom.js"></script>
    <script>
        $(document).ready(function () {            
            $(document).on('click', '.pagination a', function (event) {
                event.preventDefault();

                // Kiểm tra nếu nút phân trang đang được active
                if ($(this).parent().hasClass('active')) {
                    return;
                }

                var url = $(this).attr('href'); // Lấy URL từ link phân trang

                $.ajax({
                    url: url,
                    type: 'GET',
                    success: function (data) {
                        $('#load_review').html(data); // Cập nhật nội dung đánh giá
                    },
                    error: function () {
                        alert("Lỗi khi tải đánh giá.");
                    }
                });
            });
        });
    </script>
}
